@page "/Definitions/Application"
@model ArchiX.Library.Web.Pages.Definitions.ApplicationModel
@{
    ViewData["Title"] = "Definitions - Application";
    Layout = "~/Templates/Modern/Pages/Shared/_Layout.cshtml";
}

<div id="tab-main">
    <div id="@Model.Grid.Id-container" class="container py-4">
        <h1 class="h4 mb-3">Application Tanımları</h1>
        
        @* GridRecordAccordion: Grid üstünde accordion (başlangıçta kapalı) *@
        @await Component.InvokeAsync("GridRecordAccordion", new ArchiX.Library.Web.ViewModels.Grid.GridRecordAccordionViewModel
        {
            Id = $"grid-record-accordion-{Model.Grid.Id}",
            GridId = Model.Grid.Id ?? "appgrid",
            IsOpen = false,
            Title = "Kayıt Detayı"
        })
        
        @await Component.InvokeAsync("DatasetGrid", Model.Grid)
    </div>
</div>

<script>
    (function() {
        const gridState = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Grid, new System.Text.Json.JsonSerializerOptions { PropertyNamingPolicy = System.Text.Json.JsonNamingPolicy.CamelCase }));
        
        console.log('Application Grid State:', gridState);
        
        // DatasetGrid component zaten initGridTable() çağırıyor
        // Sadece recordEndpoint'i state'e ekleyelim
        setTimeout(function() {
            const state = window.__archixGridGetState(gridState.id);
            if (state && gridState.toolbar?.recordEndpoint) {
                state.recordEndpoint = gridState.toolbar.recordEndpoint;
                console.log('RecordEndpoint set:', gridState.toolbar.recordEndpoint);
            }
        }, 100);
    })();
</script>
