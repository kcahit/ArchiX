@page "/Dashboard"
@model ArchiX.Library.Web.Templates.Modern.Pages.DashboardModel
@{
    ViewData["Title"] = "Dashboard";
    Layout = "Shared/_Layout";
}

<!-- KPI Cards - Modern Dashboard Style -->
<div class="row g-2 mb-3">
    <!-- Weekly Sales Card -->
    <div class="col-md-6 col-xl-3">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body p-2">
                <div class="d-flex justify-content-between align-items-start mb-1">
                    <h6 class="text-muted mb-0 fw-normal small">Weekly Sales</h6>
                </div>
                <div class="d-flex align-items-end mb-1">
                    <h3 class="mb-0 me-2">$47K</h3>
                    <span class="text-success small mb-1">+3.5%</span>
                </div>
                <div style="height: 35px;">
                    <canvas id="miniChartWeeklySales"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Today Order Card -->
    <div class="col-md-6 col-xl-3">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body p-2">
                <div class="d-flex justify-content-between align-items-start mb-1">
                    <h6 class="text-muted mb-0 fw-normal small">Today Order</h6>
                </div>
                <div class="d-flex align-items-end mb-1">
                    <h3 class="mb-0 me-2">58.4K</h3>
                    <span class="text-success small mb-1">+15.3%</span>
                </div>
                <div style="height: 35px;">
                    <canvas id="miniChartTodayOrder"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Market Share Card -->
    <div class="col-md-6 col-xl-3">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body p-2">
                <div class="d-flex justify-content-between align-items-start mb-1">
                    <div>
                        <h6 class="text-muted mb-0 fw-normal small">Market Share</h6>
                        <h3 class="mb-0 mt-1">26M</h3>
                    </div>
                    <div style="width: 50px; height: 50px;">
                        <canvas id="miniChartMarketShare"></canvas>
                    </div>
                </div>
                <div class="mt-1">
                    <div class="d-flex align-items-center justify-content-between mb-1">
                        <div class="d-flex align-items-center">
                            <span class="badge rounded-pill" style="width: 6px; height: 6px; background: #0d6efd; padding: 0;"></span>
                            <small class="ms-1 text-muted" style="font-size: 0.7rem;">Samsung</small>
                        </div>
                    </div>
                    <div class="d-flex align-items-center justify-content-between mb-1">
                        <div class="d-flex align-items-center">
                            <span class="badge rounded-pill" style="width: 6px; height: 6px; background: #6c757d; padding: 0;"></span>
                            <small class="ms-1 text-muted" style="font-size: 0.7rem;">Huawei</small>
                        </div>
                    </div>
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            <span class="badge rounded-pill" style="width: 6px; height: 6px; background: #adb5bd; padding: 0;"></span>
                            <small class="ms-1 text-muted" style="font-size: 0.7rem;">Apple</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Weather Card -->
    <div class="col-md-6 col-xl-3">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body p-2">
                <h6 class="text-muted mb-1 fw-normal small">Weather</h6>
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <h3 class="mb-0">31°</h3>
                        <small class="text-muted" style="font-size: 0.7rem;">New York City</small>
                        <div class="mt-1">
                            <small class="text-muted" style="font-size: 0.65rem;">Precipitation: 12%</small>
                        </div>
                        <div>
                            <small class="text-muted" style="font-size: 0.65rem;">33° / 27°</small>
                        </div>
                    </div>
                    <div class="text-warning" style="font-size: 2.5rem;">
                        <i class="bi bi-sun-fill"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row g-3 mb-3">
    <!-- Left Column - Line Chart + Bar Chart -->
    <div class="col-lg-8">
        <!-- Line Chart -->
        <div class="card border-0 shadow-sm mb-2">
            <div class="card-header bg-white border-0 pt-2 pb-1 text-center">
                <h6 class="mb-0">Aylık Performans</h6>
                <small class="text-muted" style="font-size: 0.75rem;">Son 6 ay</small>
            </div>
            <div class="card-body p-2">
                <canvas id="performanceChart" height="60"></canvas>
            </div>
        </div>

        <!-- Bar Chart (New) -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 pt-2 pb-1 text-center">
                <h6 class="mb-0">Aylık Satışlar</h6>
                <small class="text-muted" style="font-size: 0.75rem;">Son 6 ay</small>
            </div>
            <div class="card-body p-2">
                <canvas id="monthlySalesChart" height="60"></canvas>
            </div>
        </div>
    </div>

    <!-- Right Column - Doughnut Chart -->
    <div class="col-lg-4">
        <div class="card border-0 shadow-sm h-100 d-flex flex-column">
            <div class="card-header bg-white border-0 pt-2 pb-1 text-center">
                <h6 class="mb-0">Durum Dağılımı</h6>
                <small class="text-muted" style="font-size: 0.75rem;">Genel</small>
            </div>
            <div class="card-body p-3 d-flex align-items-center justify-content-center flex-grow-1">
                <div style="width: 100%; max-width: 100%; height: 100%; min-height: 250px; position: relative;">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Recent Activity Table -->
<div class="row" style="margin-bottom: 150px;">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 pt-2 pb-1 text-center">
                <h6 class="mb-0">Son Aktiviteler</h6>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover table-sm mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="border-0" style="font-size: 0.8rem;">Durum</th>
                                <th class="border-0" style="font-size: 0.8rem;">Kullanıcı</th>
                                <th class="border-0" style="font-size: 0.8rem;">İşlem</th>
                                <th class="border-0" style="font-size: 0.8rem;">Tarih</th>
                            </tr>
                        </thead>
                        <tbody style="font-size: 0.85rem;">
                            <tr>
                                <td><span class="badge bg-success" style="font-size: 0.7rem;">Tamamlandı</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="bg-primary bg-opacity-10 text-primary rounded-circle p-1 me-2" style="font-size: 0.7rem;">
                                            <i class="bi bi-person-fill"></i>
                                        </div>
                                        <span>Ahmet Yılmaz</span>
                                    </div>
                                </td>
                                <td>Proje oluşturma</td>
                                <td class="text-muted">5 dakika önce</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-warning" style="font-size: 0.7rem;">Beklemede</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="bg-success bg-opacity-10 text-success rounded-circle p-1 me-2" style="font-size: 0.7rem;">
                                            <i class="bi bi-person-fill"></i>
                                        </div>
                                        <span>Zeynep Kaya</span>
                                    </div>
                                </td>
                                <td>Rapor hazırlama</td>
                                <td class="text-muted">1 saat önce</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-info" style="font-size: 0.7rem;">İşleniyor</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="bg-warning bg-opacity-10 text-warning rounded-circle p-1 me-2" style="font-size: 0.7rem;">
                                            <i class="bi bi-person-fill"></i>
                                        </div>
                                        <span>Mehmet Demir</span>
                                    </div>
                                </td>
                                <td>Veri analizi</td>
                                <td class="text-muted">2 saat önce</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@* Chart.js initialization - CDN loaded in _Layout.cshtml *@
<script>
    // Dashboard Chart Initialization (callable from TabHost)
    window.initDashboardCharts = function() {
        // Mini Chart 1 - Weekly Sales (Bar)
        const miniWeeklySales = document.getElementById('miniChartWeeklySales');
        if (miniWeeklySales) {
            if (window.Chart && window.Chart.getChart) {
                const existing = window.Chart.getChart(miniWeeklySales);
                if (existing) existing.destroy();
            }
            new Chart(miniWeeklySales, {
                type: 'bar',
                data: {
                    labels: ['', '', '', '', '', '', ''],
                    datasets: [{
                        data: [42, 38, 45, 41, 48, 44, 47],
                        backgroundColor: 'rgba(13, 110, 253, 0.6)',
                        borderWidth: 0,
                        barPercentage: 0.6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
            });
        }

        // Mini Chart 2 - Today Order (Line)
        const miniTodayOrder = document.getElementById('miniChartTodayOrder');
        if (miniTodayOrder) {
            if (window.Chart && window.Chart.getChart) {
                const existing = window.Chart.getChart(miniTodayOrder);
                if (existing) existing.destroy();
            }
            new Chart(miniTodayOrder, {
                type: 'line',
                data: {
                    labels: ['', '', '', '', '', '', '', ''],
                    datasets: [{
                        data: [45, 52, 48, 55, 51, 56, 54, 58.4],
                        borderColor: 'rgb(13, 110, 253)',
                        backgroundColor: 'rgba(13, 110, 253, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
            });
        }

        // Mini Chart 3 - Market Share (Doughnut)
        const miniMarketShare = document.getElementById('miniChartMarketShare');
        if (miniMarketShare) {
            if (window.Chart && window.Chart.getChart) {
                const existing = window.Chart.getChart(miniMarketShare);
                if (existing) existing.destroy();
            }
            new Chart(miniMarketShare, {
                type: 'doughnut',
                data: {
                    labels: ['Samsung', 'Huawei', 'Apple'],
                    datasets: [{
                        data: [45, 30, 25],
                        backgroundColor: [
                            'rgb(13, 110, 253)',
                            'rgb(108, 117, 125)',
                            'rgb(173, 181, 189)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '70%',
                    plugins: { 
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });
        }

        // Performance Line Chart
        const perfCtx = document.getElementById('performanceChart');
        if (perfCtx) {
            // Destroy existing chart if present
            if (window.Chart && window.Chart.getChart) {
                const existing = window.Chart.getChart(perfCtx);
                if (existing) existing.destroy();
            }

            new Chart(perfCtx, {
                type: 'line',
                data: {
                    labels: ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran'],
                    datasets: [
                        {
                            label: 'Gelir',
                            data: [12000, 19000, 15000, 25000, 22000, 30000],
                            borderColor: 'rgb(13, 110, 253)',
                            backgroundColor: 'rgba(13, 110, 253, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Gider',
                            data: [8000, 12000, 10000, 15000, 14000, 18000],
                            borderColor: 'rgb(220, 53, 69)',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            align: 'end'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('tr-TR') + ' ₺';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Status Doughnut Chart
        const statusCtx = document.getElementById('statusChart');
        if (statusCtx) {
            // Destroy existing chart if present
            if (window.Chart && window.Chart.getChart) {
                const existing = window.Chart.getChart(statusCtx);
                if (existing) existing.destroy();
            }

            new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Tamamlandı', 'Beklemede', 'İşleniyor', 'İptal'],
                    datasets: [{
                        data: [45, 25, 20, 10],
                        backgroundColor: [
                            'rgb(220, 53, 69)',   // Kırmızı
                            'rgb(139, 0, 0)',     // Koyu kırmızı
                            'rgb(50, 50, 50)',    // Koyu gri/siyah
                            'rgb(0, 0, 0)'        // Siyah
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        // Monthly Sales Bar Chart (New)
        const monthlySalesCtx = document.getElementById('monthlySalesChart');
        if (monthlySalesCtx) {
            // Destroy existing chart if present
            if (window.Chart && window.Chart.getChart) {
                const existing = window.Chart.getChart(monthlySalesCtx);
                if (existing) existing.destroy();
            }

            new Chart(monthlySalesCtx, {
                type: 'bar',
                data: {
                    labels: ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran'],
                    datasets: [
                        {
                            label: 'iPhone 18 Pro',
                            data: [4200, 5300, 4800, 6100, 5700, 6800],
                            backgroundColor: 'rgba(13, 110, 253, 0.8)',
                            borderWidth: 0
                        },
                        {
                            label: 'Galaxy S26 Ultra',
                            data: [3800, 4200, 3900, 4600, 4300, 5100],
                            backgroundColor: 'rgba(25, 135, 84, 0.8)',
                            borderWidth: 0
                        },
                        {
                            label: 'Xiaomi 17 Pro Max',
                            data: [2900, 3400, 3100, 3800, 3600, 4200],
                            backgroundColor: 'rgba(255, 193, 7, 0.8)',
                            borderWidth: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            align: 'end'
                        }
                    },
                    scales: {
                        x: {
                            stacked: false
                        },
                        y: {
                            beginAtZero: true,
                            stacked: false,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('tr-TR');
                                }
                            }
                        }
                    }
                }
            });
        }
    };

    // Auto-init on page load (for non-TabHost scenarios)
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', window.initDashboardCharts);
    } else {
        window.initDashboardCharts();
    }
</script>
