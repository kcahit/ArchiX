@page
@model ArchiX.Library.Web.Pages.Admin.Security.PolicyTestModel
@{
    ViewData["Title"] = "Policy Test";
}

<div class="container-fluid py-3">
    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
        <div>
            <h2 class="mb-0">Policy Test</h2>
            <small class="text-muted">Application ID: @Model.ApplicationId</small>
        </div>
        <div class="btn-group" role="group">
            <a asp-page="/Admin/Security/Index" asp-route-applicationId="@Model.ApplicationId" class="btn btn-outline-secondary">Dashboard</a>
            <a asp-page="/Admin/Security/PolicySettings" asp-route-applicationId="@Model.ApplicationId" class="btn btn-outline-secondary">Policy Settings</a>
            <a asp-page="/Admin/Security/AuditTrail" asp-route-applicationId="@Model.ApplicationId" class="btn btn-outline-secondary">Audit Trail</a>
            <a asp-page="/Admin/Security/Blacklist" asp-route-applicationId="@Model.ApplicationId" class="btn btn-outline-secondary">Blacklist</a>
            <a asp-page="/Admin/Security/PasswordPolicy" asp-route-applicationId="@Model.ApplicationId" class="btn btn-outline-secondary">JSON Editörü</a>
        </div>
    </div>

    <div class="row g-3">
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header">Parola Doðrulama</div>
                <div class="card-body">
                    <form method="post" class="row g-3">
                        <div class="col-12">
                            <label asp-for="Form.Password" class="form-label">Parola</label>
                            <input asp-for="Form.Password" class="form-control" autocomplete="off" />
                            <span asp-validation-for="Form.Password" class="text-danger"></span>
                        </div>
                        <div class="col-12 d-flex align-items-center gap-3">
                            <input type="hidden" asp-for="ApplicationId" />
                            <button type="submit" class="btn btn-primary">Test Et</button>
                            @if (Model.Form.Result is not null)
                            {
                                <span class="badge @(Model.Form.Result.IsValid ? "bg-success" : "bg-danger")">
                                    @(Model.Form.Result.IsValid ? "Geçti" : "Hatalar var")
                                </span>
                            }
                        </div>
                    </form>

                    @if (Model.Form.Result is not null)
                    {
                        var strengthWidth = $"{Model.Form.Result.StrengthScore}%";
                        <hr />
                        <div class="mb-3">
                            <div class="text-muted small text-uppercase">Strength Score</div>
                            <div class="progress" style="height: 12px;">
                                <div class="progress-bar @(Model.Form.Result.StrengthScore >= 70 ? "bg-success" : "bg-warning")" role="progressbar" style="width:@strengthWidth" aria-valuenow="@Model.Form.Result.StrengthScore" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <small class="text-muted">@Model.Form.Result.StrengthScore / 100</small>
                        </div>

                        @if (Model.Form.Result.Errors.Count > 0)
                        {
                            <div class="alert alert-warning">
                                <div class="fw-semibold">Hata Kodlarý</div>
                                <ul class="mb-0">
                                    @foreach (var error in Model.Form.Result.Errors)
                                    {
                                        <li>@error</li>
                                    }
                                </ul>
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-success mb-0">
                                Parola tüm kontrollerden geçti.
                            </div>
                        }

                        <div class="mt-3 text-muted small">
                            <div>History Check: @(Model.Form.Result.HistoryCheckResult.HasValue ? "Tekrarlanan parola" : "Geçti")</div>
                            <div>Pwned Count: @(Model.Form.Result.PwnedCount?.ToString() ?? "0")</div>
                        </div>
                    }
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header">Aktif Policy Özeti</div>
                <div class="card-body">
                    @if (Model.ActivePolicy is null)
                    {
                        <div class="text-muted">Policy yüklenemedi.</div>
                    }
                    else
                    {
                        <ul class="list-unstyled">
                            <li><strong>Uzunluk:</strong> @Model.ActivePolicy.MinLength - @Model.ActivePolicy.MaxLength</li>
                            <li><strong>Büyük Harf:</strong> @(Model.ActivePolicy.RequireUpper ? "Evet" : "Hayýr")</li>
                            <li><strong>Küçük Harf:</strong> @(Model.ActivePolicy.RequireLower ? "Evet" : "Hayýr")</li>
                            <li><strong>Rakam:</strong> @(Model.ActivePolicy.RequireDigit ? "Evet" : "Hayýr")</li>
                            <li><strong>Sembol:</strong> @(Model.ActivePolicy.RequireSymbol ? "Evet" : "Hayýr")</li>
                            <li><strong>Min. farklý karakter:</strong> @Model.ActivePolicy.MinDistinctChars</li>
                            <li><strong>Maks. tekrar:</strong> @Model.ActivePolicy.MaxRepeatedSequence</li>
                            <li><strong>History:</strong> @Model.ActivePolicy.HistoryCount</li>
                            <li><strong>Max yaþ (gün):</strong> @(Model.ActivePolicy.MaxPasswordAgeDays?.ToString() ?? "Sýnýrsýz")</li>
                            <li><strong>Allowed Symbols:</strong> @Model.ActivePolicy.AllowedSymbols</li>
                        </ul>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
